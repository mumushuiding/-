<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <link rel="icon" href="../static/images/favicon.ico"/>

    <title>月度工作考核</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-select.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/css/ie10-viewport-bug-workaround.css" rel="stylesheet"/>
     
    <link href="/css/grid.css" rel="stylesheet"/>
     
     
     
     
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="/css/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
   
    
    
       <!-- Bootstrap core JavaScript ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-3.2.1.js"></script>

    <script src="/js/bootstrap.min.js"></script>

    <script src="/js/holder.min.js"></script>

    <script src="/js/bootstrap-select.min.js"></script>
    
    <script src="/js/moment-with-locales.min.js"></script>
    
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    
        <!-- autosize -->
    <script src="/js/plugins/autosize.js"></script>
    <!-- 前端打印 -->
    <script src="/js/plugins/jQuery.print.js"></script>
  </head>
  
<body>
      <style>
      	div{
      		overflow:visible;
      		height:auto;
      	}
      	textarea{
      		resize : none;
      	}
      </style>
<style media="print">
    @page {
      size: auto;  /* auto is the initial value */
      margin: 0mm 0mm 0mm 0mm; /* this affects the margin in the printer settings */
    }
</style>
       <button id="print" class="pull-right btn-lg btn-primary " >
              
             <span class="glyphicon glyphicon-print" aria-hidden="true">打印</span>
       </button>
      <div id="content" class="container border1">
        <form id="f1" method="post"  th:object="${evaluation}">
		 <input type="text" th:value="*{processBean.deploymentId}" th:field="*{processBean.deploymentId}" style="display:none;"/>
         <input type="text" th:value="*{processBean.businessKey}" th:field="*{processBean.businessKey}" style="display:none;"/>
         <input type="text" th:value="*{processBean.firstTaskId}" th:field="*{processBean.firstTaskId}" style="display:none;"/>
         <input type="text" th:value="*{processBean.processInstanceId}" th:field="*{processBean.processInstanceId}" style="display:none;"/>
         <input type="text" th:value="*{id}" th:field="*{id}" style="display:none;"/>
    	<div class="row">
	    	
	          
	              <p><h2 style="text-align:center;">日常工作一线干部(工作人员)责任清单(<span th:text="${#dates.format(evaluation.createTime,'yyyy')}"/>)年</h2></p>
	
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-6">
    		                   <p>表格类型</p>
    			</div>
    			<div class="FlexItem FlexItem-md-7 ">
    			    <input type="text" th:value="*{startDate}" th:field="*{startDate}" readOnly="true"  style="display:none;"/>
    			    <input type="text" th:value="*{endDate}" th:field="*{endDate}" readOnly="true"  style="display:none;"/>
    			    <input type="text" th:value="*{sparation}" th:field="*{sparation}" readOnly="true"/>
    			</div>
    			<div class="FlexItem FlexItem-md-6">
    		            <p> 填表日期:</p>
    			</div>
    			<div class="FlexItem FlexItem-md-6">
    		        <input type="text" name="" readonly="true" th:value="${#dates.format(evaluation.createTime,'yyyy-MM-dd')}"/>
    			</div>
    		</div>
    		
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>姓名</p>			
    			</div>
    			<div class="FlexItem FlexItem-md-4">
    			      
    				<input type="text" name="" readonly="true" th:value="*{processBean.user.username}"/>			
    			</div>   
    			<div class="FlexItem FlexItem-md-4">
    				<p>部门</p>
    			</div>   
    			<div class="FlexItem FlexItem-md-10">
    				<input type="text" name="" readonly="true" th:value="*{processBean.deptName}" th:field="*{processBean.deptName}"/>
    			</div>   
    			<div class="FlexItem FlexItem-md-2">
    				<p>职务</p>		
    			</div>   
    			<div class="FlexItem FlexItem-md-4">
    				<input type="text" name="" readonly="true" th:value="*{oldPosition}" th:field="*{oldPosition}"/>	
    			</div>       			
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>岗<br/>位<br/>职<br/>责</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<textarea id="edit_1" class="form-control input-lg" placeholder="岗位职责" rows="" cols="" th:value="*{currentJobDescription}" th:field="*{currentJobDescription}" readonly="true" style="height:100%;"></textarea>
    			</div>
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>年<br/>度<br/>工<br/>作<br/>任<br/>务</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<textarea id="edit_2" class="form-control input-lg" placeholder="年度工作任务" rows="" cols="" th:value="*{currentJob}" th:field="*{currentJob}" readonly="true" style="height:100%;"></textarea>
    			</div>
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>岗<br/>位<br/>调<br/>整<br/>情<br/>况</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<div class="FlexColumn">
						<div class="FlexItem FlexItem-vd-2">
							<!-- 新部门职责 生生效时间-->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-3">
					    				<p>调整时间</p>			
					    			</div>
					    			<div class="FlexItem FlexItem-md-5" style="height:50px;">
										<div class="form-group" style="border:none;">  
						                    <!--指定 date标记-->  
						                    <div class='input-group date' id='datetimepicker2' style="height:50px;border:none;">  
						                        <input id="edit_3" type='text'  placeholder=""  readonly="true" th:field="*{ajustDate}" th:value="*{ajustDate}" style="height:100%;border:none;background:none;"/>  
						                        <span class="input-group-addon">  
						                            <span class="glyphicon glyphicon-calendar"></span>  
						                        </span>  
						                    </div>  
						                </div>			
					    			</div>   
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>现任<br/>单位</p>
					    			</div>   
					    			<div class="FlexItem FlexItem-md-12" style="height:50px;">
					    			    <div id="dept" class="FlexRow" style="height:50px;">
					    			       
					    			    	<select id="second"  title="请选择部门"  th:field="*{secondLevelId}" th:value="*{secondLevelId}" style="width:40%;height:50px;;border:none;">
									         <option value=""></option>
									          <option th:each="d:${depts}" th:value="${d.did}" th:text="${d.name}"></option>
									       </select>
									       <select id="first"  title="请选择子部门"   th:field="*{firstLevelIds}" th:value="*{firstLevelIds}" style="width:60%;height:100%;border:none;">
									         
									      </select>
					    			    </div>
					    			</div>   
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>现任<br/>职务</p>		
					    			</div>   
					    			<div class="FlexItem FlexItem-md-3">
					    				<input type="text" name="" id="edit_6" readonly="true" th:value="*{position}" th:field="*{position}"/>	
					    			</div>
					    		</div>
							<!-- /新部门职责 生生效时间-->
						</div>
						<div class="FlexItem FlexItem-vd-9">
							<!-- 岗位职责 -->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>岗<br/>位<br/>职<br/>责</p>
					    			</div>
					    			<div class="FlexItem FlexItem-md-23">
										<textarea id="edit_7"  class="form-control input-lg" placeholder="新岗位职责" rows="" cols="" th:value="*{newJobDescription}" th:field="*{newJobDescription}" readonly="true" style="height:100%;"></textarea>
					    			</div>
					    		</div>
							<!-- /岗位职责 -->
						</div>
						<div class="FlexItem FlexItem-vd-9">
							<!-- 年度工作 -->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>年<br/>度<br/>工<br/>作<br/>任<br/>务</p>
					    			</div>
					    			<div class="FlexItem FlexItem-md-23">
										<textarea id="edit_8" class="form-control input-lg" placeholder="新年度工作任务" rows="" cols="" th:value="*{newJob}" th:field="*{newJob}" readonly="true" style="height:100%;"></textarea>
					    			</div>
					    		</div>
							<!-- /年度工作 -->
						</div>
					</div>
    			</div>
    		</div>
    	</div>
    		
    	<div class="row text-center">
           <button  id="submit" type="submit" class="btn btn-lg btn-success">提交</button>
           <button  id="save" type="submit" class="btn btn-lg btn-default">保存</button>
        </div>
	   </form>
    </div>
    <script th:inline="javascript">
   
		var candidateGroupList=[];
 
        //流程发起人
		var requestedUserId=[[${evaluation.processBean.user.id}]];
		//当前编辑用户
		var sysuserid=[[${session.sysuser.id}]];
       //当前流程执行候选人组
        var currentCandidateGroup=[[${evaluation.processBean.currentCandidateGroup}]];
		
        if([[${candidateGroupList}]]){
        	candidateGroupList=[[${candidateGroupList}]];
        }
       
        
       //是否可以编辑
		var identity=[[${identity}]];
	    
	    if(identity){
	        
	        	$("[id^=edit]").each(function(){
					$(this).removeAttr("readonly");
					$(this).removeAttr("disabled");
					$(this).show();
			
				
	            });
	     }else{
	     	$("#submit").hide();
    	    $("#save").hide();
	     
	     }

        $("#submit").click(function(){
             $(this).addClass("disabled");
    	     setTimeout("$(this).removeAttr('disabled')",3000); //设置三秒后提交按钮 显示 
            $("#f1").attr("action","/system/activiti/startResponsibility/complete");
    		$("#f1").submit();

    	});
    	$("#save").click(function(){
    	    $(this).addClass("disabled");
    	     setTimeout("$(this).removeAttr('disabled')",3000); //设置三秒后提交按钮 显示 
    		 $("#f1").attr("action","/system/activiti/startResponsibility/save");
    		$("#f1").submit();
    	});
    	var actionType=[[${actionType}]];
    
    	var taskId=[[${taskId}]];
    	if(actionType=="perform"){
    	    $("#submit").html('通过');
    	    $("#save").html('驳回');
    	    $("#submit").click(function(){
	          
	           $("#f1").attr("action","/system/activiti/complete/responsibility/"+taskId+"/true");
    		    $("#f1").submit();
	    	

    	  });
	    	$("#save").click(function(){
	    		$("#f1").attr("action","/system/activiti/complete/responsibility/"+taskId+"/false");
	    		$("#f1").submit();
	    	});
    	}
    	
    	 	//日期控件
		  $('#datetimepicker1').datetimepicker({  
		        format: 'YYYY-MM-DD',  
		        locale: moment.locale('zh-cn')  
		    });   
		   $('#datetimepicker2').datetimepicker({  
		        format: 'YYYY-MM-DD',  
		        locale: moment.locale('zh-cn')  
		    }); 

        //二级联动菜单
       
        if($('#second').val()) getValue();



	    $('#second').change(function(){
			getValue();
		});
       function getValue() {
       		$.ajax({
			  type: 'POST',
			  url: "/user/selectFirstLevelDept/"+$('#second').val(),
			  dataType: "text",
			  success: function(data){
			        
			        $("#first").empty();
			        $("#first").html('<option value=""></option>');
			        $("#first").append(data);
					   var firstLevelIds=[[${evaluation.firstLevelIds}]];
				       
				        var ids=[];
							        
					   if(firstLevelIds){
				             
				        	//ids=firstLevelIds.split(",");
				           // $('#first').selectpicker('val', ids);
				           $('#first').val(firstLevelIds);

				        }
				    //$("#first").selectpicker('refresh');
			         
	
			  }
			 
			});
       }
        
        
        $("textarea").each(function(){
        
        	$(this).attr("style",'background:none;border:none;');
        });
        //设置textarea高度
        autosize(document.querySelectorAll('textarea'));
      //打印
      var groups=[[${session.sysuser.userLinkGroup}]];
       $("#print").hide();
       for(x in groups){
            
       		if(groups[x].groupTable.groupname.indexOf('考核')!=-1){
       			$("#print").show();
       			break;
       		}
       }
       $("#print").on('click', function() {
              
               var val=$("#first").val();
        
        
                var a4=700;
                var width=$("#content").width();
                
                $("#content").width(a4);
                //设置textarea高度
                $("textarea").each(function() {
                	//var height=$(this).height();
                	//$(this).height(height*width/a4+20);
                	$(this).css('overflow','auto');

                	$(this).height(this.scrollHeight+'px');
                	
                	$(this).css('overflow','hidden');
				});
				
                $('#second').hide();
              
                $("#content").find("button").hide();
                $(".input-group-addon").hide();
                
                var dept=$('#dept').html();
                var text=$('#first').find("option:selected").text();
                $('#dept').html('<p>'+text+'</p>');
                jQuery.print("#content");
                $('#dept').html(dept);
                
                $("#first").val(val);
                $("#content").find("button").show();
                 $('#second').show();
                
                 $(".input-group-addon").show();
                $("#content").width(width);

       });
  </script>
</body>
</html>