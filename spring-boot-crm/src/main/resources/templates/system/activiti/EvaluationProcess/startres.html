<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="description" content=""/>
    <meta name="author" content=""/>
    <link rel="icon" href="../static/images/favicon.ico"/>

    <title>月度工作考核</title>

    <!-- Bootstrap core CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-select.min.css" rel="stylesheet"/>
    <link href="/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <link href="/css/ie10-viewport-bug-workaround.css" rel="stylesheet"/>
     
    <link href="/css/grid.css" rel="stylesheet"/>
     
     
     
     
    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="/css/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
   
    
    
       <!-- Bootstrap core JavaScript ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="/js/jquery-3.2.1.js"></script>

    <script src="/js/bootstrap.min.js"></script>

    <script src="/js/holder.min.js"></script>

    <script src="/js/bootstrap-select.min.js"></script>
    
    <script src="/js/moment-with-locales.min.js"></script>
    
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
  </head>
  
<body>
      <style>
      	div{
      		overflow:visible;
      		height:auto;
      	}
      	textarea{
      		height:auto;
      	}
      </style>
      <div class="container border1">
        <form id="f1" method="post"  th:object="${evaluation}">
		 <input type="text" th:value="*{processBean.deploymentId}" th:field="*{processBean.deploymentId}" style="display:none;"/>
         <input type="text" th:value="*{processBean.businessKey}" th:field="*{processBean.businessKey}" style="display:none;"/>
         <input type="text" th:value="*{processBean.firstTaskId}" th:field="*{processBean.firstTaskId}" style="display:none;"/>
         <input type="text" th:value="*{processBean.processInstanceId}" th:field="*{processBean.processInstanceId}" style="display:none;"/>
         <input type="text" th:value="*{id}" th:field="*{id}" style="display:none;"/>
    	<div class="row">
	    	<div class="page-header">
              
	           <div class="FlexRow">
	           <div class="FlexItem FlexItem-md-16" style="border:none;">
	           <h2 style="text-align:right;">日常工作一线干部(工作人员)责任清单(</h2>
	           </div>
	           <div class="FlexItem FlexItem-md-2" style="border:none;">
	            <h1 style="text-align:right;"><input type="text" name=""  th:value="${#dates.format(evaluation.createTime,'yyyy')}" style="width:70px;"/></h1>
	           </div>
	           <div class="FlexItem FlexItem-md-8" style="border:none;"><h2>)年</h2></div>
	           </div>
	          
	        </div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-6">
    		                   <p>表格类型</p>
    			</div>
    			<div class="FlexItem FlexItem-md-6 ">
    			    <input type="text" th:value="*{startDate}" th:field="*{startDate}" readOnly="true"  style="display:none;"/>
    			    <input type="text" th:value="*{endDate}" th:field="*{endDate}" readOnly="true"  style="display:none;"/>
    			    <input type="text" th:value="*{sparation}" th:field="*{sparation}" readOnly="true"/>
    			</div>
    			<div class="FlexItem FlexItem-md-6">
    		            <p> 填表日期:</p>
    			</div>
    			<div class="FlexItem FlexItem-md-7">
    		        <input type="text" name="" readonly="true" th:value="${#dates.format(evaluation.createTime,'yyyy-MM-dd')}"/>
    			</div>
    		</div>
    		
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>姓名</p>			
    			</div>
    			<div class="FlexItem FlexItem-md-4">
    			      
    				<input type="text" name="" readonly="true" th:value="*{processBean.user.username}"/>			
    			</div>   
    			<div class="FlexItem FlexItem-md-4">
    				<p>部门</p>
    			</div>   
    			<div class="FlexItem FlexItem-md-8">
    				<input type="text" name="" readonly="true" th:value="*{processBean.deptName}" th:field="*{processBean.deptName}"/>
    			</div>   
    			<div class="FlexItem FlexItem-md-2">
    				<p>职务</p>		
    			</div>   
    			<div class="FlexItem FlexItem-md-7">
    				<input type="text" name="" readonly="true" th:value="*{oldPosition}" th:field="*{oldPosition}"/>	
    			</div>       			
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>岗<br/>位<br/>职<br/>责</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<textarea  class="form-control input-lg" placeholder="岗位职责" rows="" cols="" th:value="*{currentJobDescription}" th:field="*{currentJobDescription}" readonly="true" style="height:100%;"></textarea>
    			</div>
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>年<br/>度<br/>工<br/>作<br/>任<br/>务</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<textarea  class="form-control input-lg" placeholder="年度工作任务" rows="" cols="" th:value="*{currentJob}" th:field="*{currentJob}" readonly="true" style="height:100%;"></textarea>
    			</div>
    		</div>
    	</div>
    	<div class="row">
    		<div class="FlexRow">
    			<div class="FlexItem FlexItem-md-2">
    				<p>岗<br/>位<br/>调<br/>整<br/>情<br/>况</p>
    			</div>
    			<div class="FlexItem FlexItem-md-23">
					<div class="FlexColumn">
						<div class="FlexItem FlexItem-vd-2">
							<!-- 新部门职责 生生效时间-->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>调整时间</p>			
					    			</div>
					    			<div class="FlexItem FlexItem-md-4">
										<div class="form-group" >  
						                    <!--指定 date标记-->  
						                    <div class='input-group date' id='datetimepicker2'>  
						                        <input  type='text' class="form-control" placeholder="调整时间"  readonly="true" th:field="*{ajustDate}" th:value="*{ajustDate}"/>  
						                        <span class="input-group-addon">  
						                            <span class="glyphicon glyphicon-calendar"></span>  
						                        </span>  
						                    </div>  
						                </div>			
					    			</div>   
					    			<div class="FlexItem FlexItem-md-4">
					    				<p>现任单位</p>
					    			</div>   
					    			<div class="FlexItem FlexItem-md-8">
					    			    <div class="FlexRow">
					    			       
					    			    	<select id="second" class="selectpicker" data-live-search="true" title="请选择部门" disabled="true" th:field="*{secondLevelId}" th:value="*{secondLevelId}" style="width:30%;">
									          <option th:each="d:${depts}" th:value="${d.did}" th:text="${d.name}"></option>
									       </select>
									       <select id="first" class="selectpicker" data-live-search="true" title="请选择子部门" disabled="true" th:field="*{firstLevelIds}" th:value="*{firstLevelIds}" multiple="multiple" style="width:70%;">
									         
									      </select>
					    			    </div>
					    			</div>   
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>现任职务</p>		
					    			</div>   
					    			<div class="FlexItem FlexItem-md-7">
					    				<input type="text" name="" readonly="true" th:value="*{position}" th:field="*{position}"/>	
					    			</div>
					    		</div>
							<!-- /新部门职责 生生效时间-->
						</div>
						<div class="FlexItem FlexItem-vd-9">
							<!-- 岗位职责 -->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>岗<br/>位<br/>职<br/>责</p>
					    			</div>
					    			<div class="FlexItem FlexItem-md-23">
										<textarea  class="form-control input-lg" placeholder="新岗位职责" rows="" cols="" th:value="*{newJobDescription}" th:field="*{newJobDescription}" readonly="true" style="height:100%;"></textarea>
					    			</div>
					    		</div>
							<!-- /岗位职责 -->
						</div>
						<div class="FlexItem FlexItem-vd-9">
							<!-- 年度工作 -->
								<div class="FlexRow">
					    			<div class="FlexItem FlexItem-md-2">
					    				<p>年<br/>度<br/>工<br/>作<br/>任<br/>务</p>
					    			</div>
					    			<div class="FlexItem FlexItem-md-23">
										<textarea  class="form-control input-lg" placeholder="新年度工作任务" rows="" cols="" th:value="*{newJob}" th:field="*{newJob}" readonly="true" style="height:100%;"></textarea>
					    			</div>
					    		</div>
							<!-- /年度工作 -->
						</div>
					</div>
    			</div>
    		</div>
    	</div>
    		
    	<div class="row text-center">
           <button  id="submit" type="submit" class="btn btn-lg btn-success">提交</button>
           <button  id="save" type="submit" class="btn btn-lg btn-default">保存</button>
        </div>
	   </form>
    </div>
    <script th:inline="javascript">
   
		var candidateGroupList=[];
 
        //流程发起人
		var requestedUserId=[[${evaluation.processBean.user.id}]];
		//当前编辑用户
		var sysuserid=[[${session.sysuser.id}]];
       //当前流程执行候选人组
        var currentCandidateGroup=[[${evaluation.processBean.currentCandidateGroup}]];
		
        if([[${candidateGroupList}]]){
        	candidateGroupList=[[${candidateGroupList}]];
        }
        checkCandidateGroup(candidateGroupList)
        function checkCandidateGroup(candidateGroupList){
			var flag=false;
			 //当候选组为空时，如果是本人则可以修改
            if(!candidateGroupList){

		        if(requestedUserId==sysuserid){
					flag=true;
				}
            }
            
			
			//当前流程的候选用户组为空,说明流程还在提交申请阶段，那么为本人时则允许编辑
			if(!currentCandidateGroup){
				if(requestedUserId==sysuserid){
					flag=true;
				}
			}else{
			    //用户的候选用户组不为空，且用户包含它，则允许编辑
				for(x in candidateGroupList){
					if(candidateGroupList[x]==currentCandidateGroup) flag=true;
				}
			}

			if(flag){
				$('select').removeAttr("disabled");
				$('input').removeAttr("readonly");
				$('textArea').removeAttr("readonly");
			}
	        if(flag){
			   $("#submit").show();
			   $("#save").show();
			}else{
				$("#submit").hide();
			   $("#save").hide();
			}
        }
		
		
       
        $("#submit").click(function(){
          
            $("#f1").attr("action","/system/activiti/startResponsibility/complete");
    		$("#f1").submit();

    	});
    	$("#save").click(function(){
    		 $("#f1").attr("action","/system/activiti/startResponsibility/save");
    		$("#f1").submit();
    	});
    	var actionType=[[${actionType}]];
    
    	var taskId=[[${taskId}]];
    	if(actionType=="perform"){
    	    $("#submit").html('通过');
    	    $("#save").html('驳回');
    	    $("#submit").click(function(){
	          
	           $("#f1").attr("action","/system/activiti/complete/responsibility/"+taskId+"/true");
    		    $("#f1").submit();
	    	

    	  });
	    	$("#save").click(function(){
	    		$("#f1").attr("action","/system/activiti/complete/responsibility/"+taskId+"/false");
	    		$("#f1").submit();
	    	});
    	}
    	
    	 	//日期控件
		  $('#datetimepicker1').datetimepicker({  
		        format: 'YYYY-MM-DD',  
		        locale: moment.locale('zh-cn')  
		    });   
		   $('#datetimepicker2').datetimepicker({  
		        format: 'YYYY-MM-DD',  
		        locale: moment.locale('zh-cn')  
		    }); 

        //二级联动菜单
       
        if($('#second').val()) getValue();



	    $('#second').change(function(){
			getValue();
		});
       function getValue() {
       		$.ajax({
			  type: 'POST',
			  url: "/user/selectFirstLevelDept/"+$('#second').val(),
			  dataType: "text",
			  success: function(data){
			        
			        $("#first").empty();
			        $("#first").html('');
			        $("#first").append(data);
					   var firstLevelIds=[[${evaluation.firstLevelIds}]];
				        console.log("firstLevelIds="+firstLevelIds);
				        var ids=[];
							        
					   if(firstLevelIds){
				             
				        	ids=firstLevelIds.split(",");
				            $('#first').selectpicker('val', ids);

				        }
				    $("#first").selectpicker('refresh');
			         
	
			  }
			 
			});
       }
  </script>
</body>
</html>